# Pyxel_trick_or_track
<img width="953" alt="image_home" src="https://user-images.githubusercontent.com/101140119/200431082-d521a164-988b-44f0-9b53-20f6ec9cadd0.png">
# はじめに
<!-- 発端や概要を記載 -->
はじめまして，
[42tokyo Advent Calendar 2022](https://qiita.com/advent-calendar/2022/42tokyo)の8日目を担当する、changです．
今回は，Python向けのレトロゲームエンジンであるPyxelを使って，簡単なミニゲームを制作しました．Pyxelはゼロベースで学習しながらの制作でした．その際に学んだこと，役に立った知識や文献等を，時系列を追って簡単にまとめます．尚，今回はサウンドや効果音周りにまでは手を広げず，あくまでも最低限の基本要素のみとさせていただきます．
Pyxelをゼロから始めてみたい方の参考になれば幸いです．

# 目次
<!-- タイトルとアンカー名を編集 -->
1. [Pyxelとは](#pyxelとは)
2. [制作したゲーム](#制作したゲーム)
3. [環境構築とマニュアル](#環境構築とマニュアル)
4. [プログラムの基本構造](#プログラムの基本構造)
5. [サンプルコードから学ぶ](#サンプルコードから学ぶ)
6. [ドット絵アニメーションを作成](#ドット絵アニメーションを作成)
7. [キャラクターを動かす](#キャラクターを動かす)
8. [画面遷移を実装する](#画面遷移を実装する)
9. [Web上でPyxelアプリを実行する](#Web上でPyxelアプリを実行する)
10. [SNSへの共有機能を実装する](#SNSへの共有機能を実装する)
<!-- 各チャプター -->
<a id="#pyxelとは"></a>
# Pyxelとは
![pyxel_300000_downloads](https://user-images.githubusercontent.com/101140119/200431256-ad021bf0-dfc4-4367-816d-5128edecf07a.gif)
Pyxel(ピクセル)は，Python向けのオープンソースゲームエンジンです．
使える色は 16 色のみ，同時に再生できる音は 4 音までなど，レトロゲーム機を意識したシンプルな仕様で，Pythonでドット絵スタイルのゲームづくりが気軽に楽しめます．
限られた機能や仕様によって，初学者でも学びやすいことも一つの特徴です．

>仕様
Windows、Mac、Linux、Web で動作
Python によるプログラミング
16 色パレット
256x256 サイズ、3 画像バンク
256x256 サイズ、8 タイルマップ
4 音同時再生、定義可能な 64 サウンド
任意のサウンドを組み合わせ可能な 8 ミュージック
キーボード、マウス、ゲームパッド
画像・サウンド編集ツール

<a id="#制作したゲーム"></a>
# 制作したゲーム
![game_play](https://user-images.githubusercontent.com/101140119/200431412-646c8304-8c28-4711-9a98-f2b71a1dd414.gif)

https://github.com/rwatanab1999/Pyxel_trick_or_track

ゲームの内容を説明すると，お化けに捕まらずにどれだけお菓子を集められるか，という非常にシンプルなものです．集めたお菓子の数が増えると新たに異なる特徴のお化けが登場し，最大で4体のお化けに追いかけられます．現代っ子には見向きもされないようなゲーム性ですが，シンプルながらそこそこの難易度に調整しています．

この作品は，所属する42Tokyo学内で行われた，自由な解釈で「ホラー」なコードで競い合うHalloween Horror Code大会に合わせて制作しました．締切まで約3日間という限られた時間だったので，簡単に作れそうなテーマはないかなあと探していた際に，たまたまPyxelを見つけ採用しました．
「簡単に制作できる」というのが特徴のPyxelですが，もう一つ「他人に共有しやすい」という大きな特徴もあります．その代表として，GitHub上にソースを置くだけで，Webブラウザからアプリを直接起動できるという機能が挙げられます．専用リンクさえ知っていれば，環境構築もせず誰でもスマホから遊べるという恐ろしく素敵な機能ですよね．．．
以下のリンクから実際にこのゲームをプレイできるので，良ければお試しください．

https://kitao.github.io/pyxel/wasm/launcher/?play=rwatanab1999.Pyxel_trick_or_track.trick_or_track

それでは，学んだことや役に立った知識・文献をまとめていきます．

<a id="#環境構築とマニュアル"></a>
# 環境構築とマニュアル
Python3 (バージョン 3.7 以上) がインストールされている環境下で，次のコマンドの実行で簡単にインストールできます．Pythonパッケージとして，たった1コマンドで導入完了です．
```言語名:Windows
pip install -U pyxel
```
```言語名:Mac
pip3 install -U pyxel
```
詳細な仕様や使用方法については，リファレンスをご確認ください．
制作途中でわからないことも，ググる前にじっくりこちらを参照すると大体解決します．
https://github.com/kitao/pyxel/blob/main/docs/README.ja.md



<a id="#プログラムの基本構造"></a>
# プログラムの基本構造
リファレンスでも解説されていますが，
基本的にはPythonスクリプト内では，大きく4つの役割に分けてコードを記述します．
・ 初期化
・ フレームの更新処理
・ 描画処理
・ アプリケーションの実行
```
import pyxel # Pyxelモジュールをインポート

pyxel.init(160, 120) # 初期化(ウィンドウサイズを指定)

def update(): # フレームの更新処理
    if pyxel.btnp(pyxel.KEY_Q):
        pyxel.quit()

def draw(): # 描画処理
    pyxel.cls(0)
    pyxel.rect(10, 10, 20, 20, 11)

pyxel.run(update, draw)　# アプリケーションの実行
```
上のサンプルコードでは，
はじめにinit関数でウィンドウサイズを指定した後，フレーム更新処理を行うupdate関数と描画処理を行うdraw関数を，run関数の引数に指定してアプリケーションを実行しています．
しかし，複雑な処理を行わせるゲームの制作においては，あまり向かない記述方法です．以下のようなクラス構造を用いて，Pyxelの処理をラップすることがおすすめされています．
```
import pyxel

class App:
    def __init__(self): # 初期化
        pyxel.init(160, 120)
        self.x = 0
        pyxel.run(self.update, self.draw) # アプリケーションの実行

    def update(self): # フレームの更新処理
        self.x = (self.x + 1) % pyxel.width

    def draw(self): # 描画処理
        pyxel.cls(0)
        pyxel.rect(self.x, 0, 8, 8, 9)

App()
```
Python自体も初心者の方向けに，ここまでに必要な「クラス」「self」「\_\_init__」あたりの知識について，参考になりそうな文献を置いておきます．コードに触れていく中で，雰囲気がわかってくるかと思います．

- [クラスと self と \_\_init__](https://python.ms/class/#はじめに)
- [Pythonのselfとかinitを理解する](https://qiita.com/ishigen/items/2d8b6e6398743f2c8110)
- [Pythonにおける__init__の利用方法を現役エンジニアが解説【初心者向け】](https://magazine.techacademy.jp/magazine/24530)

<a id="サンプルコードから学ぶ"></a>
# サンプルコードから学ぶ
初めからリファレンスや文献を読み込むよりも，実際にコードの中で機能に触れることをおすすめします．Pyxelに関しての文献がそもそも少ないので，実装されていそうなコードの中から探す機会もあるかと思います．

まずは公式が提供するサンプルコードをダウンロードしてみましょう．
Pyxel のインストール後に、次のコマンドでカレントディレクトリに Pyxel のサンプルコードがコピーされます。
```
pyxel copy_examples
```
 14 個のサンプルコードが手に入りますが，初学者に向けたものとしてはとりあえず
「01_hello_pyxel.py」「03_draw_api_py」の 2 つのみで十分かと思います．
前者では，前章のプログラムの基本構成と pyxel.frame_count の役割を理解し，
後者では，基本的な描画APIをリファレンスを見ながら確認できれば十分です．


<a id="#ドット絵アニメーションを作成"></a>
# ドット絵アニメーションを作成
